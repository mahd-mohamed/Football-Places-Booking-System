<div class="user-management-container">
  <div class="d-flex align-items-center justify-content-between mb-4">
    <h2 class="fw-bold text-primary mb-0">User Management</h2>
    <span class="text-muted section-subtitle">Manage all users, their roles, and account status</span>

  </div>

  <!-- Users Table -->
  <div class="card shadow-sm border-0">
    <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white rounded-top">
      <h5 class="mb-0"><i class="fa fa-users me-2"></i>Users ({{ totalUsers }})</h5>
    </div>

    <div class="card-body bg-light">
      <div *ngIf="isLoading" class="loading-spinner">
        <mat-spinner></mat-spinner>
        <p>Loading users...</p>
      </div>

      <div *ngIf="!isLoading && totalUsers === 0" class="no-users">
        <mat-icon>people</mat-icon>
        <h3>No Users Found</h3>
        <p>No users match the current filters.</p>
      </div>

      <div *ngIf="!isLoading && totalUsers > 0" class="table-responsive">
        <table mat-table [dataSource]="dataSource" matSort (matSortChange)="onSortChange($event)" class="mat-elevation-z2 w-100 table table-hover align-middle rounded-3 overflow-hidden">

          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="id" class="bg-secondary text-white">#</th>
            <td mat-cell *matCellDef="let user">{{ user.id }}</td>
          </ng-container>

          <!-- Username Column -->
          <ng-container matColumnDef="username">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="username" class="bg-secondary text-white">Username</th>
            <td mat-cell *matCellDef="let user"><b>{{ user.username }}</b></td>
          </ng-container>

          <!-- Email Column -->
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="email" class="bg-secondary text-white">Email</th>
            <td mat-cell *matCellDef="let user"><i class="fa fa-envelope me-1"></i>{{ user.email }}</td>
          </ng-container>

          <!-- Role Column -->
          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="role" class="bg-secondary text-white">Role</th>
            <td mat-cell *matCellDef="let user">
              <span class="badge" [ngClass]="{
                'bg-danger': user.role === 'ADMIN',
                'bg-primary': user.role === 'ORGANIZER',
                'bg-success': user.role === 'USER'
              }">
                <i class="fa fa-user-shield me-1" *ngIf="user.role === 'ADMIN'"></i>
                <i class="fa fa-users me-1" *ngIf="user.role === 'ORGANIZER'"></i>
                <i class="fa fa-user me-1" *ngIf="user.role === 'USER'"></i>
                {{ user.role }}
              </span>
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="status" class="bg-secondary text-white">Status</th>
            <td mat-cell *matCellDef="let user">
              <span class="badge" [ngClass]="{
                'bg-success': user.status === 'ACTIVE',
                'bg-secondary': user.status === 'INACTIVE'
              }">
                <i class="fa fa-circle me-1"></i>{{ user.status }}
              </span>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="bg-secondary text-white">Actions</th>
            <td mat-cell *matCellDef="let user">
              <button mat-icon-button [matMenuTriggerFor]="roleMenu" class="btn btn-outline-secondary btn-sm" matTooltip="Change Role">
                <i class="fa fa-ellipsis-v"></i>
              </button>
              <mat-menu #roleMenu="matMenu">
                <button mat-menu-item (click)="changeUserRole(user.id, 'ADMIN')">
                  <i class="fa fa-user-shield me-2"></i>
                  Set as Admin
                </button>
                <!-- <button mat-menu-item (click)="changeUserRole(user.id, 'ORGANIZER')">
                  <i class="fa fa-users me-2"></i>
                  Set as Organizer
                </button> -->
                <button mat-menu-item (click)="changeUserRole(user.id, 'USER')">
                  <i class="fa fa-user me-2"></i>
                  Set as Player
                </button>
              </mat-menu>

              <button mat-icon-button [matMenuTriggerFor]="statusMenu" class="btn btn-outline-secondary btn-sm ms-2" matTooltip="Change Status">
                <i class="fa fa-toggle-on"></i>
              </button>
              <mat-menu #statusMenu="matMenu">
                <button mat-menu-item (click)="changeUserStatus(user.id, 'ACTIVE')">
                  <i class="fa fa-check-circle me-2"></i>
                  Activate
                </button>
                <button mat-menu-item (click)="changeUserStatus(user.id, 'INACTIVE')" class="text-danger">
                  <i class="fa fa-times-circle me-2"></i>
                  Deactivate
                </button>
              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>

      <mat-paginator
        [length]="totalUsers"
        [pageSize]="pageSize"
        [pageIndex]="currentPage"
        [pageSizeOptions]="pageSizeOptions"
        (page)="onPageChange($event)"
        showFirstLastButtons
        class="mt-3">
      </mat-paginator>
    </div>
  </div>
</div>

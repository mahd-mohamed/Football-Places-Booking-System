<div class="profile-container">
  <div class="d-flex align-items-center justify-content-between mb-4">
    <h2 class="fw-bold text-primary mb-0">Profile Management</h2>
    <span class="text-muted section-subtitle">Manage your account information and settings</span>
  </div>

  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading profile...</p>
  </div>

  <div *ngIf="!isLoading && currentUser" class="profile-content">
    <!-- Profile Information Card -->
    <div class="card shadow-sm border-0 mb-4">
      <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white rounded-top">
        <h5 class="mb-0"><i class="fa fa-user me-2"></i>Profile Information</h5>
        <button *ngIf="!isEditing" 
                mat-flat-button 
                color="accent" 
                class="btn btn-light btn-sm"
                (click)="startEditing()">
          <i class="fa fa-edit me-1"></i> Edit Profile
        </button>
      </div>
      
      <div class="card-body bg-light">
        <div class="row">
          <!-- Profile Display -->
          <div class="col-md-6">
            <div class="profile-info">
              <div class="info-item">
                <label class="info-label">Username</label>
                <div class="info-value">
                  <i class="fa fa-user me-2"></i>
                  <span *ngIf="!isEditing">{{ currentUser.username }}</span>
                  <input *ngIf="isEditing" 
                         type="text" 
                         class="form-control" 
                         [(ngModel)]="editForm.username"
                         placeholder="Enter username">
                </div>
              </div>

              <div class="info-item">
                <label class="info-label">Email</label>
                <div class="info-value">
                  <i class="fa fa-envelope me-2"></i>
                  <span>{{ currentUser.email }}</span>
                </div>
              </div>

              <div class="info-item">
                <label class="info-label">Role</label>
                <div class="info-value">
                  <i class="fa fa-user-shield me-2" *ngIf="effectiveRole === 'ADMIN'"></i>
                  <!-- <i class="fa fa-users me-2" *ngIf="effectiveRole === 'ORGANIZER'"></i> -->
                  <i class="fa fa-user me-2" *ngIf="effectiveRole === 'USER'"></i>
                  <span class="badge" [ngClass]="'bg-' + getRoleColor(effectiveRole)">
                    {{ getRoleDisplayName(effectiveRole) }}
                  </span>
                </div>
              </div>

              <div class="info-item">
                <label class="info-label">Status</label>
                <div class="info-value">
                  <i class="fa fa-circle me-2"></i>
                  <span class="badge" [ngClass]="'bg-' + getStatusColor(currentUser.status)">
                    {{ getStatusDisplayName(currentUser.status) }}
                  </span>
                </div>
              </div>

              <div class="info-item" *ngIf="currentUser.createdAt">
                <label class="info-label">Member Since</label>
                <div class="info-value">
                  <i class="fa fa-calendar me-2"></i>
                  <span>{{ formatDate(currentUser.createdAt) }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Password Change Section -->
          <div class="col-md-6">
            <div class="password-section">
              <h6 class="text-muted mb-3">
                <i class="fa fa-lock me-2"></i>Change Password
              </h6>
              
              <div *ngIf="!isEditing" class="password-info">
                <p class="text-muted small">
                  Click "Edit Profile" to change your password
                </p>
              </div>

              <div *ngIf="isEditing" class="password-form">
                <div class="mb-3">
                  <label class="form-label">Current Password</label>
                  <input type="password" 
                         class="form-control" 
                         [(ngModel)]="editForm.currentPassword"
                         placeholder="Enter current password">
                </div>

                <div class="mb-3">
                  <label class="form-label">New Password</label>
                  <input type="password" 
                         class="form-control" 
                         [(ngModel)]="editForm.newPassword"
                         placeholder="Enter new password">
                </div>

                <div class="mb-3">
                  <label class="form-label">Confirm New Password</label>
                  <input type="password" 
                         class="form-control" 
                         [(ngModel)]="editForm.confirmPassword"
                         placeholder="Confirm new password">
                </div>

                <div class="password-requirements">
                  <small class="text-muted">
                    <i class="fa fa-info-circle me-1"></i>
                    Password must be at least 6 characters long
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div *ngIf="isEditing" class="action-buttons mt-4">
          <button mat-flat-button 
                  color="primary" 
                  class="btn btn-primary me-2"
                  [disabled]="isSaving"
                  (click)="saveProfile()">
            <mat-spinner *ngIf="isSaving" diameter="16" class="me-2"></mat-spinner>
            <i class="fa fa-save me-1" *ngIf="!isSaving"></i>
            {{ isSaving ? 'Saving...' : 'Save Changes' }}
          </button>
          
          <button mat-stroked-button 
                  class="btn btn-outline-secondary"
                  [disabled]="isSaving"
                  (click)="cancelEditing()">
            <i class="fa fa-times me-1"></i>
            Cancel
          </button>
        </div>
      </div>
    </div>



  <!-- No User Found -->
  <div *ngIf="!isLoading && !currentUser" class="no-user">
    <mat-icon>person_off</mat-icon>
    <h3>User Not Found</h3>
    <p>Unable to load user profile. Please try logging in again.</p>
  </div>
</div>

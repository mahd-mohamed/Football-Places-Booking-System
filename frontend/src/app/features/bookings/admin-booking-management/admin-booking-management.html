<div class="admin-booking-management">
  <div class="d-flex align-items-center justify-content-between mb-4">
    <h2 class="fw-bold text-primary mb-0">Admin Booking Management</h2>
    <span class="text-muted section-subtitle">Manage all bookings and approve pending payments</span>
  </div>

  <!-- Bookings Table -->
  <div class="card shadow-sm border-0">
    <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white rounded-top">
      <h5 class="mb-0">
        <i class="fa fa-calendar me-2"></i>All Bookings ({{ allBookings.length }})
      </h5>
    </div>

    <div class="card-body bg-light">
      <div *ngIf="allBookings.length === 0" class="no-bookings">
        <mat-icon>event_busy</mat-icon>
        <h3>No bookings found</h3>
        <p>No bookings are currently available.</p>
      </div>

      <div *ngIf="allBookings.length > 0 && displayedColumns.length > 0" class="table-responsive">
        <table mat-table [dataSource]="allBookings" matSort
          class="mat-elevation-z2 w-100 table table-hover align-middle rounded-3 overflow-hidden">

          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-secondary text-white">Match Id</th>
            <td mat-cell *matCellDef="let booking">
              <span class="booking-id">{{ booking.id }}</span>
            </td>
          </ng-container>

          <!-- User Column -->
          <ng-container matColumnDef="user">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-secondary text-white">Booked By</th>
            <td mat-cell *matCellDef="let booking">
              <div class="user-info">
                <i class="fa fa-user me-1"></i>
                <span><b>{{ booking.userName || 'Unknown' }}</b></span>
              </div>
            </td>
          </ng-container>

          <!-- Place Column -->
          <ng-container matColumnDef="place">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-secondary text-white">Place</th>
            <td mat-cell *matCellDef="let booking">
              <div class="place-info">
                <i class="fa fa-map-marker me-1"></i>
                <span>{{ booking.placeName || 'Unknown' }}</span>
              </div>
            </td>
          </ng-container>

          <!-- âœ… Team Column -->
          <ng-container matColumnDef="team">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-secondary text-white">Team</th>
            <td mat-cell *matCellDef="let booking">
              <div class="team-info">
                <i class="fa fa-users me-1"></i>
                <span>{{ booking.teamName || 'No Team' }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Date Column -->
          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-secondary text-white">Date</th>
            <td mat-cell *matCellDef="let booking">
              <div class="date-info">
                <i class="fa fa-calendar me-1"></i>
                <span>{{ formatDate(booking.startTime) }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Time Column -->
          <ng-container matColumnDef="time">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-secondary text-white">Time</th>
            <td mat-cell *matCellDef="let booking">
              <div class="time-info">
                <i class="fa fa-clock me-1"></i>
                <span>{{ formatTime(booking.startTime) }} - {{ formatTime(booking.endTime) }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="bg-secondary text-white">Status</th>
            <td mat-cell *matCellDef="let booking">
              <span class="badge" [ngClass]="{
                'bg-success': booking.status === 'CONFIRMED',
                'bg-danger': booking.status === 'CANCELLED',
                'bg-warning text-dark': booking.status === 'PENDING_PAYMENT',
                'bg-info text-dark': booking.status === 'PENDING_PLAYERS'
              }">
                <i class="fa fa-circle me-1"></i>
                {{ getStatusText(booking.status) }}
              </span>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="bg-secondary text-white">Actions</th>
            <td mat-cell *matCellDef="let booking">
              <button mat-icon-button class="btn btn-outline-secondary btn-sm" [matMenuTriggerFor]="menu" matTooltip="Actions">
                <i class="fa fa-ellipsis-v"></i>
              </button>
              <mat-menu #menu="matMenu">
                <!-- Show approve/cancel if allowed -->
                <button *ngIf="canApprove(booking)" mat-menu-item (click)="approveBooking(booking)" class="text-success">
                  <i class="fa fa-check me-2"></i>
                  Approve Payment
                </button>
                <button *ngIf="canCancel(booking)" mat-menu-item (click)="cancelBooking(booking)" class="text-warning">
                  <i class="fa fa-times me-2"></i>
                  Cancel Booking
                </button>
          
                <!-- If status is not PENDING_PAYMENT, show disabled explanation -->
                <button *ngIf="!canApprove(booking) && !canCancel(booking)" mat-menu-item disabled>
                  <i class="fa fa-ban me-2 text-muted"></i>
                  No actions available ({{ getStatusText(booking.status) }})
                </button>
              </mat-menu>
            </td>
          </ng-container>


          <!-- Table Rows -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"
            [ngClass]="{'highlight-row': row.status === 'PENDING_PAYMENT'}"></tr>
        </table>
      </div>
    </div>
  </div>
</div>